<!doctype html>
<html>
<head>
    <script src='lib/d3.js'></script>
    <script src='lib/lodash.js'></script>
    <link rel="stylesheet" href="style.css">
    <!-- <script src='src/analysis.js'></script> -->
</head>
<body onload="loadData()">

<header>
    <h1>Everest Visualization</h1>
</header>


<img src="images/Everest_V1_default.svg" id="everest" usemap="#Mapi">
<!-- Image Map Generated by http://www.image-map.net/ -->
<map name="Mapi" id="Mapi">
    <area shape="rect" coords="643,164,748,186" alt="Everest_V1_deathzone.svg" href="Everest_V1_deathzone.svg">
    <area shape="rect" coords="494,162,522,186" alt="Everest_V1_Camp4.svg" href="Everest_V1_Camp4.svg">
    <area shape="rect" coords="469,207,503,234" alt="Everest_V1_Camp3.svg" href="Everest_V1_Camp3.svg">
    <area shape="rect" coords="516,247,544,271" alt="Everest_V1_Camp2.svg" href="Everest_V1_Camp2.svg">
    <area shape="rect" coords="468,283,504,312" alt="Everest_V1_Camp1.svg" href="Everest_V1_Camp1.svg">
    <area shape="rect" coords="481,339,555,391" alt="Everest_V1_BaseCamp.svg" href="Everest_V1_BaseCamp.svg">
    <area shape="rect" coords="489,60,502,92" alt="Everest_V1_summit.svg" href="Everest_V1_summit.svg">
</map>

<!-- Ursprüngliches Script von: https://www.mediaevent.de/xhtml/area-map.html  -->
<script>
    window.addEventListener ('load', function () {
        var map = document.querySelectorAll('#Mapi area');
        for (var i=0; i<map.length; i++) {
            if (map[i].addEventListener) {
                map[i].addEventListener('touchstart', swap, false);
                map[i].addEventListener('mouseover', swap, false);
            }
        }

        function swap(ev) {
            var lan = this.getAttribute('alt');
            document.getElementById('everest').setAttribute('src','images/' + lan);
            return false;
        }
    });
</script>




<div>
    <h2>Anzahl Personen pro Jahr</h2>
    <p>Hier findest du eine Übersicht für das ausgewählte Jahr.</p>

    <table class="e_table" style="width:50%">
        <tr>
            <th>Fatalities</th>
        </tr>
        <tr>
            <td>Hier kommen die Strichmännchen</td>
        </tr>
        <tr>
            <th>Summiters</th>
        </tr>
        <tr>
            <td>Hier kommen die Strichmännchen</td>
        </tr>
    </table>
</div>






















<div id="buttonlist">
    <button type="button">Show all</button>
</div>
<div id="fatal">
    <h2>Fatalities</h2>
</div>
<br />
<div id="climbers">
    <h2>Success</h2>
</div>

<script type="text/javascript">
    var yearSet = new Set();
    var dataArray = new Array();

    // Loading data
    function loadData() {
        d3.csv("data/Fatalities_Climbers_union.csv").then(function(unionData) {
            console.log(unionData[0]);
            addYears(unionData);

            for (var i = 0; i < unionData.length; i++) {
                dataArray[i] = unionData[i];
            }
            showData(dataArray);
        });
        console.log(yearSet);
    }

    // Create set with all years
    function addYears(data) {
        for (var i = 0; i < data.length; i++) {
            yearSet.add(data[i].Year);
        }
        yearSet.forEach(addButton);
    }

    // Create filter buttons for each year
    function addButton(value1, value2, set) {
        // Create new button with id and value
        var newbutton = document.createElement("button");
        var textnode = document.createTextNode(value2);
        newbutton.id = value2;

        // Add new button to the HTML
        document.getElementById("buttonlist").appendChild(newbutton).appendChild(textnode);

        // Add function to the new button
        document.getElementById(value2).addEventListener("click", function() {
            filterYear(value2);
        }, false);
    }

    function filterYear(year) {
        console.log(year);

        var selFatal = d3.select("#fatal")
            .selectAll("div")
            .data.filter(function(d) {
                if (d.Year === year) {
                    return d;
                }
            });
        selFatal.enter()
            .append("div")
            .text(function(d) { return d.Lastname + " " + d.Year + " " + d.Reason; });
        // showData(dataArray, year)
    }

    // Show each fatality / successful climber according to applied filters
    function showData(data, year, gender, sherpa, nation, reason) {

        function filterWith(givenData, attribute, value) {
            givenData.filter(function(d) {
                if (attribute === value) {
                    console.log(attribute);
                    return d;
                }
            });
        }

        var selFatal = d3.select("#fatal")
            .selectAll("div")
            .data(data.filter(function(d) {
                if (d.Reason !== "") {

                    if (year !== "" /*&& d.Year === year*/) {
                        // filterWith(actualData, d.Year, year);
                    }

                    if (gender !== "" && d.Gender === gender) {

                    }

                    if (sherpa !== "" && d.Sherpa === sherpa) {

                    }

                    if (nation !== "" && d.Nation === nation) {

                    }

                    if (reason !== "" && d.Reason === reason) {

                    }
                    return d;
                }
            }));
        selFatal.enter()
            .append("div")
            .text(function(d) { return d.Lastname + " " + d.Year + " " + d.Reason; });

        var selClimbers = d3.select("#climbers")
            .selectAll("div")
            .data(data.filter(function(d) {
                if (d.Reason === "") {
                    return d;
                }
            }));
        selClimbers.enter()
            .append("div")
            .text(function(d) { return d.Lastname + " " + d.Year + " " + d.Reason; });

        /*
        for (var i = 0; i < data.length; i++) {
            if (data[i].Reason !== "") {
                document.getElementById("fatal").appendChild(document.createElement("DIV")).innerHTML = data[i].Lastname + " " + data[i].Year + " " + data[i].Reason;
            } else {
                document.getElementById("climbers").appendChild(document.createElement("DIV")).innerHTML = data[i].Lastname + " " + data[i].Year + " " + data[i].Reason;
            }
        }
        */
    }

</script>



<div>
    <footer>by Sandra Meier und Norina Steiner</footer>
</div>



</body>
</html>
