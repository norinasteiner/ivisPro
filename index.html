<!doctype html>
<html>
<head>
    <script src='lib/d3.js'></script>
    <script src='lib/lodash.js'></script>
    <link rel="stylesheet" href="style.css">
    <!-- <script src='src/analysis.js'></script> -->
    <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
</head>
<body onload="loadData()">

<header>
    <h1>Everest Visualization</h1>
</header>

<!--Star Image Map-->

<img src="images/Everest_V1_default.svg" id="everest" usemap="#Mapi">
<!-- Image Map Generated by http://www.image-map.net/ -->
<map name="Mapi" id="Mapi">
    <area shape="rect" coords="643,164,748,186" alt="Everest_V1_deathzone.svg" href="Everest_V1_deathzone.svg">
    <area shape="rect" coords="494,162,522,186" alt="Everest_V1_Camp4.svg" href="Everest_V1_Camp4.svg">
    <area shape="rect" coords="469,207,503,234" alt="Everest_V1_Camp3.svg" href="Everest_V1_Camp3.svg">
    <area shape="rect" coords="516,247,544,271" alt="Everest_V1_Camp2.svg" href="Everest_V1_Camp2.svg">
    <area shape="rect" coords="468,283,504,312" alt="Everest_V1_Camp1.svg" href="Everest_V1_Camp1.svg">
    <area shape="rect" coords="481,339,555,391" alt="Everest_V1_BaseCamp.svg" href="Everest_V1_BaseCamp.svg">
    <area shape="rect" coords="489,60,502,92" alt="Everest_V1_summit.svg" href="Everest_V1_summit.svg">
</map>

<!-- Ursprüngliches Script von: https://www.mediaevent.de/xhtml/area-map.html  -->
<script>
    window.addEventListener('load', function () {
        var map = document.querySelectorAll('#Mapi area');
        for (var i = 0; i < map.length; i++) {
            if (map[i].addEventListener) {
                map[i].addEventListener('touchstart', swap, false);
                map[i].addEventListener('mouseover', swap, false);
            }
        }

        function swap(ev) {
            var lan = this.getAttribute('alt');
            document.getElementById('everest').setAttribute('src', 'images/' + lan);
            return false;
        }
    });
</script>


<!--

<div id="myBtnContainer">
    <button class="btn active" onclick="filterSelection('all')"> Show all</button>
    <button class="btn" onclick="filterSelection('records')"> Records</button>
    <button class="btn" onclick="filterSelection('sherpa')"> Sherpa</button>
    <button class="btn" onclick="filterSelection('male')"> Male</button>
    <button class="btn" onclick="filterSelection('female')"> Female</button>
</div>

<div class="container">
    <div class="filterDiv records">Test</div>
    <div class="filterDiv sherpa">Test</div>
    <div class="filterDiv male">Test</div>
    <div class="filterDiv male">Test</div>
    <div class="filterDiv male records">Test</div>
    <div class="filterDiv records">Test</div>
    <div class="filterDiv sherpa">Test</div>
    <div class="filterDiv sherpa">Test</div>
    <div class="filterDiv female">Test</div>
    <div class="filterDiv female records">Test</div>
    <div class="filterDiv records">Test</div>
    <div class="filterDiv female">Test</div>
    <div class="filterDiv female">Test</div>

</div>
-->

<!--<script>
    filterSelection("all")
    function filterSelection(c) {
        var x, i;
        x = document.getElementsByClassName("filterDiv");
        if (c == "all") c = "";
        for (i = 0; i < x.length; i++) {
            w3RemoveClass(x[i], "show");
            if (x[i].className.indexOf(c) > -1) w3AddClass(x[i], "show");
        }
    }

    function w3AddClass(element, name) {
        var i, arr1, arr2;
        arr1 = element.className.split(" ");
        arr2 = name.split(" ");
        for (i = 0; i < arr2.length; i++) {
            if (arr1.indexOf(arr2[i]) == -1) {element.className += " " + arr2[i];}
        }
    }

    function w3RemoveClass(element, name) {
        var i, arr1, arr2;
        arr1 = element.className.split(" ");
        arr2 = name.split(" ");
        for (i = 0; i < arr2.length; i++) {
            while (arr1.indexOf(arr2[i]) > -1) {
                arr1.splice(arr1.indexOf(arr2[i]), 1);
            }
        }
        element.className = arr1.join(" ");
    }

    // Add active class to the current button (highlight it)
    var btnContainer = document.getElementById("myBtnContainer");
    var btns = btnContainer.getElementsByClassName("btn");
    for (var i = 0; i < btns.length; i++) {
        btns[i].addEventListener("click", function(){
            var current = document.getElementsByClassName("active");
            current[0].className = current[0].className.replace(" active", "");
            this.className += " active";
        });
    }
</script>&ndash;&gt;-->

<!--End Filters-->


<div>
    <h2>Anzahl Personen pro Jahr</h2>
    <p>Hier findest du eine Übersicht für das ausgewählte Jahr.</p>

    <div ID="Scrollmenu">

        <a href="#Scrollmenu" class="active" onclick="deleteFilters()">Show all</a>

    </div>



    <table class="e_table">
        <tr>
            <th>Fatalities</th>
        </tr>
        <tr id="fatal">
            <td></td>
        </tr>
        <tr>
            <th>Summiters</th>
        </tr>
        <tr id="climbers">
            <td></td>
        </tr>
    </table>

</div>

<script type="text/javascript">
    var yearSet = new Set();
    var dataArray = new Array();
    var filterElement = {
        year: "",
        gender: "",
        sherpa: "",
        nation: "",
        reason: ""
    };

    // Loading data
    function loadData() {
        d3.csv("data/Fatalities_Climbers_union.csv").then(function (unionData) {
            console.log(unionData[0]);
            addYears(unionData);

            for (var i = 0; i < unionData.length; i++) {
                dataArray[i] = unionData[i];
            }
            showData(dataArray, filterElement);
        });
        console.log(yearSet);
    }

    // Create set with all years
    function addYears(data) {
        for (var i = 0; i < data.length; i++) {
            yearSet.add(data[i].Year);
        }
        yearSet.forEach(addButton);
    }

    // Create filter buttons for each year
    function addButton(value1, value2, set) {
        // Create new button with id and value
        var newbutton = document.createElement("a");
        newbutton.href = "#Scrollmenu";
        var textnode = document.createTextNode(value2);
        newbutton.id = value2;

        // Add new button to the HTML
        document.getElementById("Scrollmenu").appendChild(newbutton).appendChild(textnode);


        // Add function to the new button
        document.getElementById(value2).addEventListener("click", function () {
            filterYear(value2);
            var current = document.getElementsByClassName("active");
            current[0].className = "";
            this.className += " active";
        }, false);

    }

    // Filter function for each year
    function filterYear(year) {
        console.log(year);
        filterElement.year = year;
        showData(dataArray, filterElement);
    }

    // Delete all existing filters
    function deleteFilters() {
        filterElement.year = "";
        filterElement.gender = "";
        filterElement.sherpa = "";
        filterElement.nation = "";
        filterElement.reason = "";
        showData(dataArray, filterElement);
    }

    // Show each fatality / successful climber according to applied filters
    function showData(data, givenFilter) {

        // Function to filter the data according to the given filter
        function filterData(d) {
            var toReturn = true;
            if ((givenFilter.year !== "" && d.Year !== givenFilter.year) ||
                (givenFilter.gender !== "" && d.Gender !== givenFilter.gender) ||
                (givenFilter.sherpa !== "" && d.Sherpa !== givenFilter.sherpa) ||
                (givenFilter.nation !== "" && d.Nation !== givenFilter.nation) ||
                (givenFilter.reason !== "" && d.Reason !== givenFilter.reason)
            ) {
                toReturn = false;
            }
            return toReturn;
        }

        // Fatalities: Add new needed divs
        var selFatal = d3.select("#fatal")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason !== "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }));
        selFatal.enter()
            .append("div")
            .attr("class", "tooltip")
            .append("span")
            .select(function () {
                return this.parentNode;
            })
            .append("svg")
            .attr("width", 50)
            .attr("height", 50)
            .append("svg:image");

        // Fatalities: Set right text
        d3.select("#fatal")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason !== "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }))
            .select("span")
            .attr("class", "tooltiptext")
            .text(function (d) {
                return d.Lastname + " " + d.Sherpa + " " + d.Nation + " " + d.Reason + " " + d.Year;
            });

        // Fatalities: Add right images
        d3.select("#fatal")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason !== "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }))
            .select("svg")
            .select("image")
            .attr("xlink:href", function (d) {
                if (d.Gender === "f") {
                    return "images/stickwoman.svg";
                } else {
                    return "images/stickman.svg";
                }
            });

        // Fatalities: Remove unnecessary divs
        d3.select("#fatal")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason !== "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }))
            .exit().remove();


        // Climbers: Add new needed divs
        var selClimbers = d3.select("#climbers")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason === "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }));
        selClimbers.enter()
            .append("div")
            .attr("class", "tooltip")
            .append("span")
            .select(function () {
                return this.parentNode;
            })
            .append("svg")
            .attr("width", 50)
            .attr("height", 50)
            .append("svg:image");

        // Climbers: Set right text
        d3.select("#climbers")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason === "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }))
            .select("span")
            .attr("class", "tooltiptext")
            .text(function (d) {
                return d.Lastname + " " + d.Sherpa + " " + d.Nation + " " + d.Reason + " " + d.Year;
            });

        // Climbers: Add right images
        d3.select("#climbers")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason === "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }))
            .select("svg")
            .select("image")
            .attr("xlink:href", function (d) {
                if (d.Gender === "f") {
                    return "images/stickwoman.svg";
                } else {
                    return "images/stickman.svg";
                }
            });

        // Climbers: Remove unnecessary divs
        d3.select("#climbers")
            .select("td")
            .selectAll("div")
            .data(data.filter(function (d) {
                if (d.Reason === "") {
                    var toReturn = filterData(d);
                    if (toReturn) {
                        return d;
                    }
                }
            }))
            .exit().remove();

    }

</script>


<div>
    <footer>by Sandra Meier und Norina Steiner</footer>
</div>


</body>
</html>
